# System Documentation Audit

**Date**: 2026-02-18
**Docs audited**: SYSTEM_DESIGN.md, pipeline-concepts.md
**Previous audit**: First audit
**Recent merges**: R-003 (Reference File Template Convention), R-004 (Structured Agent Result Protocol), and earlier proposals (P0.5 and others)

## Overall Health: MINOR ISSUES

## Executive Summary

The Clarity Loop documentation set is in good structural health. SYSTEM_DESIGN.md and pipeline-concepts.md are well-organized, internally coherent, and serve complementary purposes without excessive redundancy. The two documents cross-reference each other appropriately and maintain a clear separation of concerns -- SYSTEM_DESIGN.md is the comprehensive architecture reference, while pipeline-concepts.md is the user-facing conceptual guide.

The primary issues are stale counts resulting from the R-004 merge. The addition of `agent-result-protocol.md` incremented the Tier 2 file count from 21 to 22, but SYSTEM_DESIGN.md Section 1 still claims "21 Tier 2 files". Additionally, the audit dimension count in SYSTEM_DESIGN.md says "8" while the actual reference file (audit-mode.md) has been expanded to 9 dimensions (adding Parking Lot Health). There is also a missing template file (`parking.md`) from the S17 inventory, and the S1 skill table omits bootstrap-brownfield from the inline mode list while correctly counting 7 modes.

These are all mechanical count mismatches -- no architectural contradictions, no terminology drift, and no design principle violations were found.

## Findings by Dimension

### Dimension 1: Cross-Document Consistency

**SYSTEM_DESIGN.md vs. pipeline-concepts.md**: The two documents are well-aligned. Content that appears in both is consistent:

- **Protection model**: Both describe the same 3 authorized operations (bootstrap, merge, correct), the same 2 exempt files (.manifest.md, .pipeline-authorized), and the same marker lifecycle. No contradictions.
- **Tracking files**: Both describe the same 4 tracking files (DECISIONS.md, RESEARCH_LEDGER.md, PROPOSAL_TRACKER.md, PARKING.md) with consistent column definitions.
- **Context system**: Both describe the same 3-layer progressive disclosure with consistent layer names, file locations, and loading protocols.
- **Configuration**: Both present the same `.clarity-loop.json` fields with identical defaults and descriptions.
- **Warmth gradient**: Both present the same 6-stage gradient with identical warmth levels and interaction styles.
- **Category tags**: Both list the same 22 decision categories with identical scope and consumer columns.
- **Reference file convention**: pipeline-concepts.md Section "Reference File Structure" correctly points to SYSTEM_DESIGN.md Section 1 for the full specification.
- **Agent result protocol**: pipeline-concepts.md Section "Subagent Communication" correctly summarizes the protocol and points to SYSTEM_DESIGN.md Section 1 for the architectural overview.

**One minor finding**: pipeline-concepts.md line 421 says "Four statuses" and line 424 says "Five result types" -- these match SYSTEM_DESIGN.md exactly. No cross-doc conflict.

### Dimension 2: Within-Document Consistency

#### SYSTEM_DESIGN.md

**Finding W-1: S1 skill table omits bootstrap-brownfield from inline mode list.**
Line 164 reads: `bootstrap, triage, research, structure, proposal, context (7 modes)`. This lists 6 mode names but claims 7 modes. The missing mode is `bootstrap-brownfield`, which is correctly documented in the S3 Mode Summary table (line 386). The count "(7 modes)" is correct, but the inline comma-separated list is incomplete.

**Finding W-2: Tier 2 count is stale after R-004 merge.**
Line 121 reads: "14 Tier 1 files, 21 Tier 2 files." The actual count is 14 Tier 1 (Structured) and 22 Tier 2 (Guided). The addition of `agent-result-protocol.md` (Guided tier) in R-004 incremented the Tier 2 count from 21 to 22 but the text was not updated. Total still correctly says 36 reference files (14 + 22 = 36), so the total is accurate even though the split is wrong.

**Finding W-3: Audit dimension count is stale.**
Multiple locations in SYSTEM_DESIGN.md reference "8 audit dimensions" or "8-dimension":
- Line 198 (S2 Mermaid diagram): `"8-dimension health"`
- Line 484 (S4 Mode Summary table): `"8-dimension system-wide health check"`
- Lines 500-511 (S4 Eight Audit Dimensions table): Lists 8 dimensions with header "Eight Audit Dimensions"

The actual audit-mode.md reference file defines **9 dimensions** (Phase 2 is titled "Nine-Dimension Analysis" at audit-mode.md line 82). The 9th dimension is "Parking Lot Health" (audit-mode.md line 219). This dimension was likely added after the SYSTEM_DESIGN.md sections were written.

**Finding W-4: S17 templates section claims "4 files" but actual count is 5.**
Line 1416 reads: "Templates (4 files)". The inventory table lists: decisions.md, research-ledger.md, proposal-tracker.md, status.md. But the actual `templates/` directory contains 5 files -- the missing file is `parking.md` (the PARKING.md template). This template is clearly intended to exist given that PARKING.md is described throughout both docs as a tracking file, but its template is not listed in S17.

**Finding W-5: S1 Mermaid diagram consistency with S17 tables.**
The S1 Mermaid diagram (lines 37-74) correctly shows:
- cl-researcher: SKILL.md + 6 references (matches S17)
- cl-reviewer: SKILL.md + 10 references (matches S17)
- cl-designer: SKILL.md + 10 references (matches S17)
- cl-implementer: SKILL.md + 10 references (matches S17)
- hooks/: 2 Hooks (but actually 4 files -- the diagram shows 2 hook scripts + 2 config files correctly, labeled as "2 Hooks")
- templates/: 4 Tracking Files (should be 5 per actual directory, but S17 also says 4)

The Mermaid diagram is internally consistent with S17 but both share the same gap (missing parking.md).

**No contradictions found** between S1 skill descriptions and their corresponding architecture sections (S3-S6). Mode descriptions, mode counts (except the bootstrap-brownfield inline list gap), and output descriptions are consistent throughout.

#### pipeline-concepts.md

**No within-document consistency issues found.** The document is internally coherent. Sections reference each other correctly, and the terminology is consistent throughout.

### Dimension 3: Completeness

**Verification of "36 reference files" claim**: Confirmed. The actual file system contains exactly 36 reference files across 4 skills:
- cl-researcher: 6 (matches S17)
- cl-reviewer: 10 (matches S17)
- cl-designer: 10 (matches S17)
- cl-implementer: 10 (matches S17)

**Verification of mode counts per skill**:
- cl-researcher: 7 modes (bootstrap, bootstrap-brownfield, triage, research, structure, proposal, context) -- SKILL.md confirms 7. **Correct.**
- cl-reviewer: 9 modes (review, re-review, fix, merge, verify, audit, correct, sync, design-review) -- SKILL.md confirms 9. **Correct.**
- cl-designer: 4 modes (setup, tokens, mockups, build-plan) -- SKILL.md confirms 4. **Correct.**
- cl-implementer: 8 modes (spec, spec-review, start, run, autopilot, verify, status, sync) -- SKILL.md confirms 8. **Correct.**
- Total: 28 modes. **Correct.**

**Verification of "13 dispatch sites" claim** (SYSTEM_DESIGN.md line 129): Confirmed. By scanning all reference files for "Result protocol" blocks that instruct subagent dispatch:

| # | File | Dispatch Site | Result Type |
|---|------|--------------|-------------|
| 1 | tokens-mode.md | Pre-generation during user review | design-plan |
| 2 | mockups-mode.md | Screen layout planning subagents | design-plan |
| 3 | mockups-mode.md | Per-screen .pen file generation | design-plan |
| 4 | spec-mode.md | System doc reading (Phase 2) | digest |
| 5 | autopilot-mode.md | Parallel task group execution | implementation |
| 6 | run-mode.md | Parallel task group execution | implementation |
| 7 | review-mode.md | Dimension analysis for long proposals | consistency |
| 8 | verify-mode.md | Fresh system doc reading | digest |
| 9 | verify-mode.md | Doc pair consistency checking | consistency |
| 10 | re-review-mode.md | Previous review reading | digest |
| 11 | audit-mode.md | System doc reading (Phase 1) | digest |
| 12 | audit-mode.md | Dimension analysis (Phase 2) | multiple |
| 13 | audit-mode.md | Doc pair consistency checking (Dim 1) | consistency |

**13 dispatch sites confirmed across all 4 skills.** Dispatch distribution: cl-designer (3), cl-implementer (3), cl-reviewer (7). Note: cl-researcher has 0 dispatch sites, which is expected since research modes are conversational, not parallel.

**Verification of tier assignments**: Each reference file's YAML frontmatter `tier:` field was checked against S17's Tier column. All 36 files match. No mismatches between frontmatter and documentation.

**Missing template**: `templates/parking.md` exists on disk but is absent from S17. This is a completeness gap.

### Dimension 4: Staleness

**Finding S-1: Tier 2 count "21" should be "22".**
Location: SYSTEM_DESIGN.md line 121.
The R-004 merge added `agent-result-protocol.md` as a Guided (Tier 2) file. The text "21 Tier 2 files" was not updated to "22 Tier 2 files". This is a direct post-merge staleness artifact.

**Finding S-2: Audit dimension count "8" should be "9" in SYSTEM_DESIGN.md.**
Locations: SYSTEM_DESIGN.md lines 198, 484, 500-511.
The audit-mode.md reference file was expanded to 9 dimensions (adding "Parking Lot Health"), but SYSTEM_DESIGN.md still references 8 dimensions in three locations. This update predates R-004 but was not caught during previous merges.

**Finding S-3: S17 templates count "4" should be "5".**
Location: SYSTEM_DESIGN.md line 1416.
The `templates/parking.md` file exists but is not listed. This is likely an omission from the original S17 inventory or a subsequent addition that was not reflected in the docs.

**No pre-R-003 or pre-R-004 references to old counts were found beyond the above.** The "36 reference files", "28 modes", "4 skills", and "13 dispatch sites" counts are all current and accurate.

### Dimension 5: Structural Integrity

**SYSTEM_DESIGN.md section numbering**: Sections 1 through 17 follow a logical sequence:
1. Architecture Overview (entry point)
2. End-to-End Pipeline Flow (overview)
3-6. Per-skill architecture (cl-researcher, cl-reviewer, cl-designer, cl-implementer)
7. State Management
8. Protection Model
9. Context System
10. Configuration System
11. Decision Journal System
12. Spec Generation Pipeline
13. Implementation Tracking
14. Verification and Audit Systems
15. Feedback Loops and Error Recovery
16. Warmth Gradient
17. Complete File Inventory

The ordering is logical: overview first, then per-skill detail, then cross-cutting systems, then operational concerns, and finally the inventory. No structural issues.

**pipeline-concepts.md section ordering**: Pipeline Depth, System Doc Protection, Manifest-Based Context Loading, Tracking Files, Context Files, Emerged Concepts, Configuration, Warmth Gradient, Directory Structure, Reference File Structure, Subagent Communication. This follows a logical flow from high-level concepts to implementation details. No structural issues.

**Mermaid diagram syntax**: All Mermaid diagrams in SYSTEM_DESIGN.md were reviewed for syntax validity:
- S1 Plugin Structure (`graph TD`): Valid.
- S1 Created Directory Structure (`graph LR`): Valid.
- S2 Main Forward Path (`flowchart TD`): Valid. Uses subgraphs, styling, and conditional edges correctly.
- S2 Typical Walkthrough (`sequenceDiagram`): Valid.
- S3 Bootstrap Decision Tree (`flowchart TD`): Valid.
- S3 Research State Machine (`stateDiagram-v2`): Valid. Uses nested states.
- S4 Review-Fix-Merge Path (`flowchart TD`): Valid.
- S4 Merge Authorization (`sequenceDiagram`): Valid.
- S5 Designer Pipeline (`flowchart LR`): Valid.
- S6 Spec Generation Pipeline (`flowchart TD`): Valid.
- S6 Run Mode Task Loop (`flowchart TD`): Valid.
- S6 Task Lifecycle (`stateDiagram-v2`): Valid. Uses nested states.
- S6 Verify Mode Dimensions (`graph LR`): Valid.
- S7 Tracking File Relationships (`erDiagram`): Valid.
- S11 Decision Flow (`flowchart TD`): Valid.
- S12 Spec Categories (`flowchart TD`): Valid.
- S14 Verification Entry Points (`graph TD`): Valid. Uses styling.
- S15 Feedback Loop Map (`flowchart TD`): Valid. Uses styling.

**Note on Mermaid styling**: Several diagrams use `style` directives with `fill` and `stroke` but without `color:#000`. Per the project's Mermaid conventions (from Hermit's CLAUDE.md), `color:#000` should always be included when using custom fill/stroke. However, since this convention is from the Hermit project and not Clarity Loop's own documented convention, this is informational only.

## Finding Table

| ID | Severity | Dimension | Location | Description | Suggestion |
|----|----------|-----------|----------|-------------|------------|
| F-1 | Minor | Within-Doc | SYSTEM_DESIGN.md line 164 | S1 skill table lists 6 mode names for cl-researcher but claims "(7 modes)" -- bootstrap-brownfield is omitted from the inline list | Add "bootstrap-brownfield" to the comma-separated mode list: "bootstrap, bootstrap-brownfield, triage, research, structure, proposal, context (7 modes)" |
| F-2 | Minor | Staleness | SYSTEM_DESIGN.md line 121 | Tier 2 count says "21" but actual is 22 after R-004 added agent-result-protocol.md (Guided) | Update to "14 Tier 1 files, 22 Tier 2 files" |
| F-3 | Major | Staleness / Within-Doc | SYSTEM_DESIGN.md lines 198, 484, 500-511 | Audit described as "8 dimensions" in 3 locations, but audit-mode.md defines 9 dimensions (Parking Lot Health added as dimension 9) | Update all 3 locations to say "9 dimensions". Add dimension 9 (Parking Lot Health) to the S4 audit dimensions table. Update S2 Mermaid diagram text. |
| F-4 | Minor | Completeness | SYSTEM_DESIGN.md line 1416 | S17 Templates section says "4 files" but actual directory has 5 -- `templates/parking.md` is missing from the inventory | Add `templates/parking.md` row to the S17 Templates table. Update count to "5 files". |
| F-5 | Informational | Cross-Doc | pipeline-concepts.md line 414 | pipeline-concepts.md references "See SYSTEM_DESIGN.md Section 1 (Reference File Convention)" which is accurate. Similarly line 433 references "See SYSTEM_DESIGN.md Section 1 (Structured Agent Result Protocol)" which is also accurate. Both cross-references are valid. | No action needed -- noting for audit trail. |

## Recommendations

**1. Immediate (correction-level fixes, no proposal needed):**

These are all mechanical count updates with no architectural implications. They can be handled via `/cl-reviewer correct`:

- **F-2**: Update SYSTEM_DESIGN.md line 121 from "21 Tier 2 files" to "22 Tier 2 files"
- **F-3**: Update SYSTEM_DESIGN.md lines 198, 484, and 500-511 from "8 dimensions" to "9 dimensions", and add the Parking Lot Health dimension to the S4 audit dimensions table
- **F-1**: Add "bootstrap-brownfield" to the S1 skill table mode list on line 164
- **F-4**: Add `templates/parking.md` to S17 Templates table and update the count from "4 files" to "5 files"

**2. No "Next cycle" or "Hygiene" items identified.**

The documentation set is clean beyond the count mismatches above. No terminology drift, no architectural contradictions, no stale cross-references, and no redundant specifications with subtle differences were found.

---

*This is the first system documentation audit for Clarity Loop. All findings above establish the baseline for future trend analysis.*
